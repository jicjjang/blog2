<!DOCTYPE html><html><head><link rel="canonical" href="https://jicjjang.github.io"/><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Inconsolata|Lora|Space+Mono:700"/><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:400,500,400italic,300italic,300,500italic,700,700italic,900,900italic"/><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/4.2.0/normalize.min.css"/><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/styles/default.min.css"/><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"/><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/highlight.min.js"></script><title>June blog</title><link rel="stylesheet" href="/static/css/main.css"/><link rel="stylesheet" href="/static/css/spinner.css"/><link rel="icon" href="/static/favicon.png"/><link rel="alternate" hrefLang="x-default" href="https://jicjjang.github.io"/><link rel="alternate" hrefLang="ko-kr" href="https://jicjjang.github.io"/><meta http-equiv="cache-control" content="Public"/><meta http-equiv="Expires" content="1800"/><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><meta name="description" content="This blog has been used since 2019 using Nextjs with Reactjs"/><meta name="author" content="Junseok, Choi &lt;jicjjang12@gmail.com&gt;"/><meta name="google-site-verification" content="DL3OehOD_wV9A1S0SRWoeXbMtlE5SeUZPlwGrFvPHQ8"/><meta name="naver-site-verification" content="a914a06593ce48762aa25cbb7d5e96042da6e549"/><meta name="robots" content="index,follow"/><meta name="og:type" content="blog"/><meta name="twitter:card" content="summary"/><meta name="twitter:creator" content="@jicjjang"/><meta name="twitter:site" content="June"/><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/github-markdown-css/3.0.1/github-markdown.min.css"/><meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/><meta charSet="utf-8"/><title>Fast CGI - June blog</title><meta name="og:title" content="Fast CGI"/><meta name="og:url" content="https://jicjjang.github.io/post/php-fastcgi"/><meta name="og:site_name" content="Fast CGI"/><meta name="og:description" content="ERROR: An another FPM instance seems to already listen on /var/run/php5-fpm.sock 오류 해결하기"/><meta name="og:image" content="https://jicjjang.github.io/static/image/php/fastcgi/fastcgi.jpg"/><meta name="twitter:description" content="ERROR: An another FPM instance seems to already listen on /var/run/php5-fpm.sock 오류 해결하기"/><meta name="twitter:title" content="Fast CGI"/><meta name="twitter:url" content="https://jicjjang.github.io/post/php-fastcgi"/><meta name="twitter:site" content="https://jicjjang.github.io/post/php-fastcgi"/><meta name="twitter:domain" content="https://jicjjang.github.io/post/php-fastcgi"/><meta name="twitter:image" content="https://jicjjang.github.io/static/image/php/fastcgi/fastcgi.jpg"/><meta name="next-head-count" content="14"/><link rel="preload" href="/_next/static/1K6jiUe679ZNAQ69RjW6W/pages/post.js" as="script"/><link rel="preload" href="/_next/static/1K6jiUe679ZNAQ69RjW6W/pages/_app.js" as="script"/><link rel="preload" href="/_next/static/runtime/webpack-9369c5c69dbf6d4912cb.js" as="script"/><link rel="preload" href="/_next/static/chunks/commons.15c31151fcdd343a2908.js" as="script"/><link rel="preload" href="/_next/static/runtime/main-702dd6d8b1f9483d47f1.js" as="script"/></head><body><div id="__next"><main><article itemProp="blogPost" itemscope="" itemType="http://schema.org/BlogPosting"><header class="section-padding--lg mast"><a class="nav nav--white" itemProp="url" href="/"><i class="fa fa-lg fa-arrow-left"></i><span>Back to Posts</span></a><figure class="absolute-bg mast__img" style="background-image:url(/static/image/php/fastcgi/fastcgi.jpg)"></figure><div class="mast__container"><span><time itemProp="datePublished">7 / 11, 2015</time></span><h1 itemProp="name headline">Fast CGI</h1><span>Posted in <!-- -->Php</span></div></header><section class="section-padding post markdown-body" itemProp="articleBody"><p><h2 id="문제의-발단--새로-구입한-서버에-nginx와-php-설치를-마치고-테스트용-html-파일을-실행시켜보고-잘된다고-생각하고-몇일-후">문제의 발단 : 새로 구입한 서버에 nginx와 php 설치를 마치고 테스트용 html 파일을 실행시켜보고 잘된다고 생각하고 몇일 후...</h2></p>
<p><code>ERROR: An another FPM instance seems to already listen on /var/run/php5-fpm.sock</code></p>
<figure style="text-align: center;">
    <img src="https://jicjjang.github.io/static/image/php/fastcgi/error-log1.png" alt="image">
</figure>

<p>물론, /var/log/php5-fpm.log 파일도 마찬가지였습니다.</p>
<figure style="text-align: center;">
    <img src="https://jicjjang.github.io/static/image/php/fastcgi/error-log2.png" alt="image">
</figure>

<p>대충 FPM 인스턴스가 이미 있다.. 라는 에러와 함께 nginx에서 php가 돌아가지 않는다는걸 뒤늦게 깨닫고 nginx, fpm 설정들을 다 찾으며 3~4일을 헤매었습니다...</p>
<h4 id="1-재부팅">1. 재부팅.</h4>
<p>대부분 구글에 있는 포스팅의 내용은</p>
<ul>
<li>&#39;php-fpm 재부팅 하세요!&#39;</li>
<li>&#39;ps aux | grep php로 php를 찾아서 pkill 후 다시 service php5-fpm restart 하세요!&#39;</li>
<li>&#39;/etc/init.d/php5-fpm reload 후, /etc/init.d/ph5-fpm restart 하세요!&#39;</li>
</ul>
<p>이 세가지 였습니다. 제가 생각해도 인스턴스가 이미 있다는 에러니까 프로세스 종료 후 다시 시작 하는게 맞겠다 싶었습니다. 구글님이 시키는대로 해야지...  </p>
<p>...  </p>
<p>몇번의 시도 후 포기... 하지만 대부분의 포스팅이 위의 3개 중 하나였습니다.</p>
<h4 id="2-재설치">2. 재설치.</h4>
<p>그럼 아예 다시 설치 해 보겠습니다..</p>
<p><code>sudo apt-get remove php5-fpm &amp; sudo apt-get install php5-fpm</code></p>
<p>다시 설치하니, index.php를 실행하면 빈 화면만 나오면 사이트 페이지가 <code>502 bad gateway error</code> 페이지로 바뀌었습니다. 하지만 처음 나왔던 에러는 그대로 나왔습니다. ㅠㅠ....</p>
<h4 id="3-다시-구글링">3. 다시 구글링.</h4>
<p>한참 구글링을 하다</p>
<p><a href="http://wildlyinaccurate.com/solving-502-bad-gateway-with-nginx-php-fpm/">http://wildlyinaccurate.com/solving-502-bad-gateway-with-nginx-php-fpm/</a></p>
<p>이 블로그를 발견했습니다.</p>
<p>제가 했던 삽질과 다른 점은 <code>php5</code>와 <code>php5-cgi</code>를 다시 설치했다는 점과, <code>sudo chmod go+rw /var/run/php5-fpm.sock</code> fpm 소켓 부분의 권한 변경이었습니다.
권한부분에서의 에러는 없었으므로 php5-cgi의 문제였습니다.</p>
<p>결론 : 정확히 어떤 부분인지는 모르겠으나, php-fpm과 php-cgi와의 관계에서 나온 에러로, php-cgi를 재설치 하니까 에러가 사라졌습니다.  </p>
<blockquote>
<p>cgi란? CGI 는 하나의 요청(Request)에 하나의 프로세스를 생성한다. 이것은 프로세스를 생성하고 삭제하는 과정에서 많은 부하가 발생한다. 당연히 느리다. 이를 개선하기 위해서 등장한 것이 FastCGI이다. FastCGI는 요청이 있을 때마다 프로세스가 만들어지는 것이 아니라 만들어진 프로세스가 계속해서 새로운 요청들을 처리한다. 덕분에 프로세스를 생성하고 제거하는데 들어가는 부하가 줄어든다. - wikipedia</p>
</blockquote>
<blockquote>
<p>php-fpm란? FastCGI Process Manager의 약자로, php를 FastCGI 모드로 동작할 수 있게 해줍니다. (5.4 이후 부터는 php 내장이라고 합니다 ^^;)</p>
</blockquote>
<hr>
<p>개발은 언제나 사소한 오류로 시간을 잡아먹게 하지만 그 부분을 해결했을 때의 쾌감 덕분에 계속 코딩을 할 수 있는거 같습니다.<br>이 포스팅으로 제가 구글링 한 것 처럼 누군가 비슷한 에러를 고칠 수 있게 되었으면 좋겠습니다.</p>
</section><section class="profile"><div class="profile__card"><div class="profile__img"><figure class="absolute-bg" style="background-image:url(/static/image/mine.jpg)"></figure></div><div class="profile__container"><p>프론트 개발을 좋아하고 꾸준히 공부하는 백엔드 개발자. 새로운 기술에 관심이 많음. React + Vue 개발 진행중. 현재 Kakaopay 재직중.</p><ul class="profile__social"><li><a class="fa fa-lg fa-envelope-o" href="mailto:jicjjang12@gmail.com"></a></li><li><a class="fa fa-lg fa-github" href="https://github.com/jicjjang" target="_blank"></a></li><li><a class="fa fa-lg fa-linkedin" href="https://www.linkedin.com/in/jicjjang" target="_blank"></a></li><li><a class="fa fa-lg fa-instagram" href="https://instagram.com/jicjjang" target="_blank"></a></li></ul></div></div></section></article><section class="next"><a class="next__link" itemProp="url" style="background-image:url(/static/image/etc/malware/security.jpg)" href="/post/malware/"><div class="next__container"><span>Read Next</span><h2>여행중인 나를 당황하게 한 멀웨어 공격</h2></div></a></section><div id="disqus_thread" style="margin:50px 10% 0 10%"></div></main></div><script id="__NEXT_DATA__" type="application/json">{"dataManager":"[]","props":{"pageProps":{"postId":"php-fastcgi"}},"page":"/post","query":{"id":"php-fastcgi"},"buildId":"1K6jiUe679ZNAQ69RjW6W","nextExport":true}</script><script nomodule="" src="/_next/static/runtime/polyfills-ebd4705da3402b2d78e1.js"></script><script async="" data-next-page="/post" src="/_next/static/1K6jiUe679ZNAQ69RjW6W/pages/post.js"></script><script async="" data-next-page="/_app" src="/_next/static/1K6jiUe679ZNAQ69RjW6W/pages/_app.js"></script><script src="/_next/static/runtime/webpack-9369c5c69dbf6d4912cb.js" async=""></script><script src="/_next/static/chunks/commons.15c31151fcdd343a2908.js" async=""></script><script src="/_next/static/runtime/main-702dd6d8b1f9483d47f1.js" async=""></script><script src="/static/script/google-analytics.js"></script></body></html>