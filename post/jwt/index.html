<!DOCTYPE html><html><head><link rel="canonical" href="https://jicjjang.github.io"/><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Inconsolata|Lora|Space+Mono:700"/><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:400,500,400italic,300italic,300,500italic,700,700italic,900,900italic"/><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/4.2.0/normalize.min.css"/><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/styles/default.min.css"/><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"/><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/highlight.min.js"></script><title>June blog</title><link rel="stylesheet" href="/static/css/main.css"/><link rel="stylesheet" href="/static/css/spinner.css"/><link rel="icon" href="/static/favicon.png"/><link rel="alternate" hrefLang="x-default" href="https://jicjjang.github.io"/><link rel="alternate" hrefLang="ko-kr" href="https://jicjjang.github.io"/><meta http-equiv="cache-control" content="Public"/><meta http-equiv="Expires" content="1800"/><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><meta name="description" content="This blog has been used since 2019 using Nextjs with Reactjs"/><meta name="author" content="Junseok, Choi &lt;jicjjang12@gmail.com&gt;"/><meta name="google-site-verification" content="DL3OehOD_wV9A1S0SRWoeXbMtlE5SeUZPlwGrFvPHQ8"/><meta name="naver-site-verification" content="a914a06593ce48762aa25cbb7d5e96042da6e549"/><meta name="robots" content="index,follow"/><meta name="og:type" content="blog"/><meta name="twitter:card" content="summary"/><meta name="twitter:creator" content="@jicjjang"/><meta name="twitter:site" content="June"/><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/github-markdown-css/3.0.1/github-markdown.min.css"/><meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/><meta charSet="utf-8"/><title>Would you mind using a JWT? - June blog</title><meta name="og:title" content="Would you mind using a JWT?"/><meta name="og:url" content="https://jicjjang.github.io/post/jwt"/><meta name="og:site_name" content="Would you mind using a JWT?"/><meta name="og:description" content="JWT에 대해"/><meta name="og:image" content="https://jicjjang.github.io/static/image/etc/jwt/background.jpg"/><meta name="twitter:description" content="JWT에 대해"/><meta name="twitter:title" content="Would you mind using a JWT?"/><meta name="twitter:url" content="https://jicjjang.github.io/post/jwt"/><meta name="twitter:site" content="https://jicjjang.github.io/post/jwt"/><meta name="twitter:domain" content="https://jicjjang.github.io/post/jwt"/><meta name="twitter:image" content="https://jicjjang.github.io/static/image/etc/jwt/background.jpg"/><meta name="next-head-count" content="14"/><link rel="preload" href="/_next/static/1K6jiUe679ZNAQ69RjW6W/pages/post.js" as="script"/><link rel="preload" href="/_next/static/1K6jiUe679ZNAQ69RjW6W/pages/_app.js" as="script"/><link rel="preload" href="/_next/static/runtime/webpack-9369c5c69dbf6d4912cb.js" as="script"/><link rel="preload" href="/_next/static/chunks/commons.15c31151fcdd343a2908.js" as="script"/><link rel="preload" href="/_next/static/runtime/main-702dd6d8b1f9483d47f1.js" as="script"/></head><body><div id="__next"><main><article itemProp="blogPost" itemscope="" itemType="http://schema.org/BlogPosting"><header class="section-padding--lg mast"><a class="nav nav--white" itemProp="url" href="/"><i class="fa fa-lg fa-arrow-left"></i><span>Back to Posts</span></a><figure class="absolute-bg mast__img" style="background-image:url(/static/image/etc/jwt/background.jpg)"></figure><div class="mast__container"><span><time itemProp="datePublished">8 / 9, 2017</time></span><h1 itemProp="name headline">Would you mind using a JWT?</h1><span>Posted in <!-- -->Etc</span></div></header><section class="section-padding post markdown-body" itemProp="articleBody"><p>회사에서 서버 개발을 하면서 Session과 Cache이 복잡하게 얽혀있고, 분리된 여러 서버를 넘나들며
사용하기 힘들다는 생각을 하게되었습니다. 특히, 인증 부분에 있어서 맡아서 하는 부분이 없다보니
개발을 해볼 수 있는 환경이 아니었습니다. 그래서 우연히 알게 된 jwt에 대해 공부를 해보았습니다.</p>
<hr>
<h1 id="1-basic">1. basic</h1>
<p>JSON Web Token (JWT)는 디지털 서명을 통해 확인하고 신뢰할 수있는 정보를 보내는 데 사용됩니다.
가장 기본적인 형태의 JWT를 사용하면 서명으로 데이터 (Claim)에 서명 할 수 있으며 나중에
비밀 서명 키로 확인할 수 있습니다.</p>
<p>JWT는 base64url로 인코딩 된 값 3개를 마침표로 구분하여 표시합니다.</p>
<figure style="text-align: center;">
  <img src="https://jicjjang.github.io/static/image/etc/jwt/structure.jpg" alt="image"
    style="display:inline-block; width:100%; max-width: 800px; margin:0 auto;">
</figure>

<p><code>(이 그림에서 나타나는 정보로 알 수 있는 것은 encrypt 된 값이 plain 값일 때의 정보들을 계속
가지고 있다는 점입니다. 그렇다면 DB에 질의를 하지 않고, 지속적으로 데이터를 가지고 있을 수 있다는 점을
알 수 있습니다.)</code></p>
<p>이제 그림의 3가지 값에 대해 알아봅시다.</p>
<span style="color:red; word-break: break-all;">
eyJ3eXBiOiJKV1QiDCJCgGciOiDIUcD1NiJ7
</span>.<span style="color:purple; word-break: break-all;">
cyJ3c2KySWEiOiIiMVdmONZwZj0zNWRhLTE4ZjItODZhYk1jZWYzOTD0NjBvYmWidJ
</span>.<span style="color:blue; word-break: break-all;">
-xN_h82PHVTCMA9vdoErcZxH-x5mb13y1f37t3rGzcM</span>

<p><code>.</code> 으로 합하여 놓은 <code>Header</code> / <code>Claim (Payload)</code> / <code>Signature</code> 입니다. 이제 하나씩 알아봅시다.</p>
<h2 id="header">Header</h2>
<p>Header에는 JWT에 사용 된 해시 알고리즘과 토큰을 설명하는 간단한 JavaScript 객체의 인코딩 된
문자열 표현입니다.</p>
<h2 id="claim-payload">Claim (Payload)</h2>
<p>토큰의 핵심으로 데이터를 저장합니다. Payload 길이는 JWT에 저장하는 데이터의 양에 비례하기 때문에
최소한의 데이터만 저장하길 권장합니다. (해시 값 자체는 길어지지만 Decrypt 하는 시간 또한 리소스입니다.)</p>
<p>또한, Claim은 다시 <code>reserved</code> / <code>public</code> / <code>private</code> 으로 나뉩니다.</p>
<h3 id="1-reserved-claim">1) reserved Claim</h3>
<p>의무 사항은 아니지만 권장되는 (미리 정의 된) Claim 입니다.</p>
<ul>
<li>iss : 토큰 발급자</li>
<li>exp : 만료 타임 스탬프 (초단위) (만료 된 토큰 거부)</li>
<li>iat : JWT가 발행 된 시간. JWT의 나이를 결정하는 데 사용</li>
<li>nbf : &quot;not before&quot;는 토큰이 활성화 될 미래의 시간</li>
<li>jti : JWT의 고유 식별자. JWT가 재사용되거나 재생되는 것을 방지</li>
<li>sub : 토큰의 대상 (드물게 사용됨)</li>
<li>aud : 토큰의 대상 (거의 사용되지 않음)</li>
</ul>
<h3 id="2-public-claim">2) public Claim</h3>
<p>자유롭게 정의할 수 있습니다. 그러나 (충돌 방지 네임 스페이스가 포함된) URI로 정의되어야 합니다.</p>
<h3 id="3-private-claim">3) private Claim</h3>
<p>사용자가 정의하는 Claim 입니다.</p>
<hr>
<p>Claim은 아래와 같이 사용합니다.</p>
<pre><code class="language-json">{
  &quot;sub&quot;: &quot;1234567890&quot;,
  &quot;name&quot;: &quot;JunSeok Choi&quot;,
  &quot;admin&quot;: true
}</code></pre>
<h2 id="signature">Signature</h2>
<p>Signature 에는 Header 와 Payload를 기반으로 생성한 서명값이 들어갑니다.  </p>
<pre><code class="language-javascript">HMACSHA256(base64UrlEncode(header) + &quot;.&quot; + base64UrlEncode(payload), secret)</code></pre>
<h1 id="2-action">2. Action</h1>
<p>jwt가 실제로 브라우저와 서버 사이에서는 아래와 같이 동작합니다.</p>
<figure style="text-align: center;">
  <img src="https://jicjjang.github.io/static/image/etc/jwt/diagram.jpg" alt="image"
    style="display:inline-block; width:100%; max-width: 800px; margin:0 auto;">
</figure>

<h3 id="1-사용자가-id-pw를-서버로-보내-로그인을-한다">1) 사용자가 id, pw를 서버로 보내 로그인을 한다.</h3>
<h3 id="2-서버에서-secret-키로-jwt-값을-만든다">2) 서버에서 secret 키로 jwt 값을 만든다.</h3>
<h3 id="3-브라우저로-jwt-값을-전송한다">3) 브라우저로 jwt 값을 전송한다.</h3>
<h3 id="4-브라우저에서-인증-헤더와-함께-jwt-값을-보낸다-보낼-때-다른-값도-같이-보낼겁니다">4) 브라우저에서 인증 헤더와 함께 jwt 값을 보낸다. (보낼 때 다른 값도 같이 보낼겁니다.)</h3>
<h3 id="5-서버에서-jwt-signature-값을-체크하여-데이터를-조회한다">5) 서버에서 jwt Signature 값을 체크하여 데이터를 조회한다.</h3>
<h3 id="6-결과를-브라우저로-보낸다">6) 결과를 브라우저로 보낸다.</h3>
<hr>
<p>가장 고민했던 부분은 사실 토큰 탈취 시, 사용자 계정을 빼앗길지 아닐지에 대한 여부였습니다.
사용자마자 secret 키 값이 다르면 토큰을 탈취당해도 개개인마다의 secret 키가 다르니
jwt 해시가 되지 않을 줄 알았으나, 개개인이 아닌 App 마다의 secert 키가 있는 구조여서
기존 Session, Cookie를 사용할 때와 동일하게 토큰이 중요 이슈로 남아있게 되었습니다.</p>
<p>하지만 서버에 있는 secert값을 유추하기 힘들기 때문에 (거의 불가능) 보안적인 측면에서
안전할 것이라 여겨지며 기존 Session, Cookie 구조보다는 훨씬 가볍게 사용할 수 있을 것 같아
SPA 프로젝트에서 유용할 것으로 보여집니다.</p>
</section><section class="profile"><div class="profile__card"><div class="profile__img"><figure class="absolute-bg" style="background-image:url(/static/image/mine.jpg)"></figure></div><div class="profile__container"><p>프론트 개발을 좋아하고 꾸준히 공부하는 백엔드 개발자. 새로운 기술에 관심이 많음. React + Vue 개발 진행중. 현재 Kakaopay 재직중.</p><ul class="profile__social"><li><a class="fa fa-lg fa-envelope-o" href="mailto:jicjjang12@gmail.com"></a></li><li><a class="fa fa-lg fa-github" href="https://github.com/jicjjang" target="_blank"></a></li><li><a class="fa fa-lg fa-linkedin" href="https://www.linkedin.com/in/jicjjang" target="_blank"></a></li><li><a class="fa fa-lg fa-instagram" href="https://instagram.com/jicjjang" target="_blank"></a></li></ul></div></div></section></article><section class="next"><a class="next__link" itemProp="url" style="background-image:url(/static/image/review/youdontknowjs/you-dont-know-js.jpg)" href="/post/review-you-dont-know-js/"><div class="next__container"><span>Read Next</span><h2>[Review] 중급자를 위한 You don&#x27;t know JS</h2></div></a></section><div id="disqus_thread" style="margin:50px 10% 0 10%"></div></main></div><script id="__NEXT_DATA__" type="application/json">{"dataManager":"[]","props":{"pageProps":{"postId":"jwt"}},"page":"/post","query":{"id":"jwt"},"buildId":"1K6jiUe679ZNAQ69RjW6W","nextExport":true}</script><script nomodule="" src="/_next/static/runtime/polyfills-ebd4705da3402b2d78e1.js"></script><script async="" data-next-page="/post" src="/_next/static/1K6jiUe679ZNAQ69RjW6W/pages/post.js"></script><script async="" data-next-page="/_app" src="/_next/static/1K6jiUe679ZNAQ69RjW6W/pages/_app.js"></script><script src="/_next/static/runtime/webpack-9369c5c69dbf6d4912cb.js" async=""></script><script src="/_next/static/chunks/commons.15c31151fcdd343a2908.js" async=""></script><script src="/_next/static/runtime/main-702dd6d8b1f9483d47f1.js" async=""></script><script src="/static/script/google-analytics.js"></script></body></html>