<!DOCTYPE html><html><head><link rel="canonical" href="https://jicjjang.github.io"/><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Inconsolata|Lora|Space+Mono:700"/><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:400,500,400italic,300italic,300,500italic,700,700italic,900,900italic"/><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/4.2.0/normalize.min.css"/><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/styles/default.min.css"/><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"/><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/highlight.min.js"></script><title>June blog</title><link rel="stylesheet" href="/static/css/main.css"/><link rel="stylesheet" href="/static/css/spinner.css"/><link rel="icon" href="/static/favicon.png"/><link rel="alternate" hrefLang="x-default" href="https://jicjjang.github.io"/><link rel="alternate" hrefLang="ko-kr" href="https://jicjjang.github.io"/><meta http-equiv="cache-control" content="Public"/><meta http-equiv="Expires" content="1800"/><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><meta name="description" content="This blog has been used since 2019 using Nextjs with Reactjs"/><meta name="author" content="Junseok, Choi &lt;jicjjang12@gmail.com&gt;"/><meta name="google-site-verification" content="DL3OehOD_wV9A1S0SRWoeXbMtlE5SeUZPlwGrFvPHQ8"/><meta name="naver-site-verification" content="a914a06593ce48762aa25cbb7d5e96042da6e549"/><meta name="robots" content="index,follow"/><meta name="og:type" content="blog"/><meta name="twitter:card" content="summary"/><meta name="twitter:creator" content="@jicjjang"/><meta name="twitter:site" content="June"/><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/github-markdown-css/3.0.1/github-markdown.min.css"/><meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/><meta charSet="utf-8"/><title>Dooray bot scheduler (Server) - June blog</title><meta name="og:title" content="Dooray bot scheduler (Server)"/><meta name="og:url" content="https://jicjjang.github.io/post/dooray-bot-server"/><meta name="og:site_name" content="Dooray bot scheduler (Server)"/><meta name="og:description" content="사내 메신저 봇 스케쥴러 만들기"/><meta name="og:image" content="https://jicjjang.github.io/static/image/etc/dooray/background.png"/><meta name="twitter:description" content="사내 메신저 봇 스케쥴러 만들기"/><meta name="twitter:title" content="Dooray bot scheduler (Server)"/><meta name="twitter:url" content="https://jicjjang.github.io/post/dooray-bot-server"/><meta name="twitter:site" content="https://jicjjang.github.io/post/dooray-bot-server"/><meta name="twitter:domain" content="https://jicjjang.github.io/post/dooray-bot-server"/><meta name="twitter:image" content="https://jicjjang.github.io/static/image/etc/dooray/background.png"/><meta name="next-head-count" content="14"/><link rel="preload" href="/_next/static/1K6jiUe679ZNAQ69RjW6W/pages/post.js" as="script"/><link rel="preload" href="/_next/static/1K6jiUe679ZNAQ69RjW6W/pages/_app.js" as="script"/><link rel="preload" href="/_next/static/runtime/webpack-9369c5c69dbf6d4912cb.js" as="script"/><link rel="preload" href="/_next/static/chunks/commons.15c31151fcdd343a2908.js" as="script"/><link rel="preload" href="/_next/static/runtime/main-702dd6d8b1f9483d47f1.js" as="script"/></head><body><div id="__next"><main><article itemProp="blogPost" itemscope="" itemType="http://schema.org/BlogPosting"><header class="section-padding--lg mast"><a class="nav nav--white" itemProp="url" href="/"><i class="fa fa-lg fa-arrow-left"></i><span>Back to Posts</span></a><figure class="absolute-bg mast__img" style="background-image:url(/static/image/etc/dooray/background.png)"></figure><div class="mast__container"><span><time itemProp="datePublished">6 / 27, 2017</time></span><h1 itemProp="name headline">Dooray bot scheduler (Server)</h1><span>Posted in <!-- -->Etc</span></div></header><section class="section-padding post markdown-body" itemProp="articleBody"><p><h3 id="-이-글은-사내-메신저인-dooray에서-활용할-bot-scheduler에-대한-소개로-비정상적인-경로로의-접근은-하지-말아주시기-바랍니다-">!!! 이 글은 사내 메신저인 Dooray에서 활용할 bot scheduler에 대한 소개로, 비정상적인 경로로의 접근은 하지 말아주시기 바랍니다. !!!</h3></p>
<p><hr></p>
<p>Front 게시물에 이어서 바로 서버 사용법을 설명드리겠습니다. 일단 서버는 노드로 구현이되어있고,
타이머를 돌면서 1분마다 firebase를 찔러보며 hook time이 현재 시간과 일치하는 스케쥴의
내용을 Dooray로 쏴줍니다.</p>
<h1 id="1-dooray-hooker">1. <a href="https://github.com/jicjjang/DoorayHooker">Dooray Hooker</a></h1>
<p>서버에서 사용하는 <a href="https://github.com/jicjjang/menubot">menubot</a> 에서의 동작은 크게 3가지로 나뉩니다.  </p>
<ol>
<li>이미지 자르기  </li>
<li>이미지 위치 구하기</li>
<li>글자 인식</li>
</ol>
<p>이러한 동작을 위해 기본 세팅이 조금 필요합니다.</p>
<h2 id="1-1-기본-세팅">1-1. 기본 세팅</h2>
<p>우선 이미지를 자를 때 필요한 <a href="https://www.imagemagick.org/script/index.php">imagemagick</a> 라이브러리 입니다.
brew로 간단하게 설치할 수 있습니다.</p>
<pre><code class="language-bash">$ brew install imagemagick</code></pre>
<p>그리고 이미지 인식에 사용할 <a href="https://cloud.google.com/sdk/docs/quickstart-mac-os-x">google-vision</a>이 필요합니다.
 (구글 비전은 링크를 보시고 순서대로 실행해주세요)</p>
<h2 id="1-2-설정-파일">1-2. 설정 파일</h2>
<pre><code class="language-bash">$ git clone <a href="https://github.com/jicjjang/DoorayHooker">https://github.com/jicjjang/DoorayHooker</a>
$ cd DoorayHooker
$ npm install forever -g
$ npm install
$ npm run start</code></pre>
<p>우선 npm을 설치하고 서버를 띄웁니다.
이번에도 바로 에러가 뜹니다.</p>
<figure style="text-align: center;">
  <img src="https://jicjjang.github.io/static/image/etc/dooray/scheduleServer/error1.png" alt="image" style="display:inline-block; width:80%; margin:0 auto;">
</figure>

<p>다시 <code>&quot;ex.config.js&quot;</code> 파일을 참고하여 <code>&quot;config.js&quot;</code> 파일을 만듭니다.</p>
<h4 id="그리고-메뉴-이미지를-넣어줍니다-메뉴봇을-이용할-때-기본적으로-imgall_menumenupng-경로로-저장된-이미지를-사용하도록-해놨습니다-해당-경로로-식사메뉴-이미지를-다운받아서-해당-경로로-넣어줍니다">그리고 메뉴 이미지를 넣어줍니다. 메뉴봇을 이용할 때, 기본적으로 &quot;img/all_menu/menu.png&quot; 경로로 저장된 이미지를 사용하도록 해놨습니다. 해당 경로로 식사메뉴 이미지를 다운받아서 해당 경로로 넣어줍니다.</h4>
<h2 id="1-3-사용">1-3. 사용</h2>
<p>서버에서는 기본 세팅이 복잡하고, 사용에 대해선 큰 어려움이 없습니다.</p>
<pre><code class="language-bash">$ npm run start</code></pre>
<p>서버를 시작해주시면 됩니다. <a href="https://www.npmjs.com/package/forever">forever</a>를 사용하였기 때문에
서버가 시작되면</p>
<pre><code class="language-bash">$ forever list</code></pre>
<p>명령어로 현재 서버에 대한 로그파일을 확인하실 수 있습니다.</p>
<figure style="text-align: center;">
  <img src="https://jicjjang.github.io/static/image/etc/dooray/scheduleServer/log1.png" alt="image" style="display:inline-block; width:80%; margin:0 auto;">
</figure>

<figure style="text-align: center;">
  <img src="https://jicjjang.github.io/static/image/etc/dooray/scheduleServer/log2.png" alt="image" style="display:inline-block; width:80%; margin:0 auto;">
</figure>

<p>등록되어있는 스케쥴들이 정상적으로 봇으로 동작하는 모습을 보실 수 있습니다!</p>
<hr>
<p>봇을 만든것에 대한 경험 공유는 여기까지 입니다.
사용하시면서 어려우실 만한 부분은 google vision의 설치일 것 같네요... (저도 꽤나 오래 걸렸습니다...)</p>
<p>감사합니다.</p>
</section><section class="profile"><div class="profile__card"><div class="profile__img"><figure class="absolute-bg" style="background-image:url(/static/image/mine.jpg)"></figure></div><div class="profile__container"><p>프론트 개발을 좋아하고 꾸준히 공부하는 백엔드 개발자. 새로운 기술에 관심이 많음. React + Vue 개발 진행중. 현재 Kakaopay 재직중.</p><ul class="profile__social"><li><a class="fa fa-lg fa-envelope-o" href="mailto:jicjjang12@gmail.com"></a></li><li><a class="fa fa-lg fa-github" href="https://github.com/jicjjang" target="_blank"></a></li><li><a class="fa fa-lg fa-linkedin" href="https://www.linkedin.com/in/jicjjang" target="_blank"></a></li><li><a class="fa fa-lg fa-instagram" href="https://instagram.com/jicjjang" target="_blank"></a></li></ul></div></div></section></article><section class="next"><a class="next__link" itemProp="url" style="background-image:url(/static/slides/image/oss/background.jpg)" href="/slides/developer-life/"><div class="next__container"><span>Read Next</span><h2>[Presentation] 현실적인 개발로 먹고살기</h2></div></a></section><div id="disqus_thread" style="margin:50px 10% 0 10%"></div></main></div><script id="__NEXT_DATA__" type="application/json">{"dataManager":"[]","props":{"pageProps":{"postId":"dooray-bot-server"}},"page":"/post","query":{"id":"dooray-bot-server"},"buildId":"1K6jiUe679ZNAQ69RjW6W","nextExport":true}</script><script nomodule="" src="/_next/static/runtime/polyfills-ebd4705da3402b2d78e1.js"></script><script async="" data-next-page="/post" src="/_next/static/1K6jiUe679ZNAQ69RjW6W/pages/post.js"></script><script async="" data-next-page="/_app" src="/_next/static/1K6jiUe679ZNAQ69RjW6W/pages/_app.js"></script><script src="/_next/static/runtime/webpack-9369c5c69dbf6d4912cb.js" async=""></script><script src="/_next/static/chunks/commons.15c31151fcdd343a2908.js" async=""></script><script src="/_next/static/runtime/main-702dd6d8b1f9483d47f1.js" async=""></script><script src="/static/script/google-analytics.js"></script></body></html>